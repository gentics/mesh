<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="dns-prefetch" href="//oss.maxcdn.com" />
<link rel="dns-prefetch" href="//ajax.googleapis.com" />

<title>Clustering</title>
<meta name="description" content="">
<meta name="author" content="">
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Clustering" />
<meta name="twitter:description" content="" />
<meta name="twitter:image:src" content="https://getmesh.io/assets/gentics-card.png" />

<meta property="og:title" content="Clustering">
<meta property="og:url" content="https://getmesh.io/docs/clustering/">
<meta property="og:description" content="">
<meta property="og:image" content="https://getmesh.io/assets/gentics-card.png">
<link rel="icon" href="../../favicon.ico">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
<link rel="shortcut icon" href="../../assets/g_logo_small.png" type="image/png" />
<link href="../../styles/docs.css" media="screen" rel="stylesheet">


<link href="https://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
    crossorigin="anonymous">
<script src="../../js/GCM.min.js"></script>
<script>
    window.GCM.init('/js/GCM-config.json', 'en', 1, true);
</script>

<link href="https://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">

</head>

<body class="body-navbar-">
    <nav class="navbar navbar-default navbar--top">
    <div class="container-fluid">
        
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
                aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../">
                <img class="logo" src="../../assets/gentics-mesh-logo.png" alt="Gentics Logo" />
            </a>
        </div>

        
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav"> 
                <li>
                    <a href="../../features">Features</a>
                </li>
                <li>
                    <a href="../../docs">Documentation</a>
                </li>
                <li>
                    <a href="../../demo">Demo</a>
                </li>
                <li>
                    <a href="../../services">Services</a>
                </li>
                <li>
                    <a href="../../training">Trainings</a>
                </li>
                <li>
                    <a href="../../premium-features">Premium Features</a>
                </li>
                
                <li>
                    <a class="btn btn-primary btn-download" href="../../download">Download</a>
                </li>
            </ul>
        </div>
        
    </div>
    
</nav>


    
<div class="topsection-wrapper">
    <div class="topsection container">
        <div class="row">
            <div class="col-md-12">
                <h1>Clustering</h1>
            </div>
        </div>
    </div>
</div>
 
  <div class="container docs-content">
    <div class="row">
      <div class="col-sm-12 col-md-push-9 col-md-3 hidden-xs hidden-sm">
        <div id="sidebar" data-spy="affix">
            
        </div>
      </div>
      <div class="col-sm-12 col-md-pull-3 col-md-9">
        <div class="toc hidden-md hidden-lg">
          <h2>Clustering</h2>
          
        </div>
        <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_basics">Basics</a></li>
<li><a href="#_configuration">Configuration</a>
<ul class="sectlevel2">
<li><a href="#_port_mapping">Port Mapping</a></li>
</ul>
</li>
<li><a href="#_setup">Setup</a></li>
<li><a href="#_node_discovery">Node discovery</a>
<ul class="sectlevel2">
<li><a href="#_kubernetes">Kubernetes</a></li>
</ul>
</li>
<li><a href="#_session_distribution">Session distribution</a></li>
<li><a href="#_elasticsearch">Elasticsearch</a></li>
<li><a href="#_handling_binary_data">Handling binary data</a></li>
<li><a href="#_cluster_coordination">Cluster Coordination</a>
<ul class="sectlevel2">
<li><a href="#_configuration_2">Configuration</a></li>
<li><a href="#_master_election">Master Election</a></li>
<li><a href="#_headers">Headers</a></li>
</ul>
</li>
<li><a href="#_transaction_handling_change_propagation">Transaction handling / Change propagation</a></li>
<li><a href="#_upgrading_a_cluster">Upgrading a cluster</a>
<ul class="sectlevel2">
<li><a href="#_online_upgrade">Online Upgrade</a></li>
<li><a href="#_offline_upgrade">Offline Upgrade</a></li>
</ul>
</li>
<li><a href="#_aws_gce">AWS / GCE</a></li>
<li><a href="#_scaling">Scaling</a></li>
<li><a href="#_faq">FAQ</a></li>
<li><a href="#_monitoring">Monitoring</a></li>
<li><a href="#_limitations">Limitations</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_basics">Basics</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
This section is irrelevant, if <a href="../../premium-features/sql-db/#docs">SQL RDBMS storage premium feature</a> is used. Please refer to the feature documentation, as well as the clustering documentation for the chosen RDBMS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to run Gentics Mesh in a cluster mode.
When done so all changes to your data with one exception are automatically being distributed to other instances.
Binary data (uploads) are currently not being handled by our cluster implementation and need dedicated handling.</p>
</div>
<div class="paragraph">
<p>At its core Gentics Mesh makes use of the OrientDB clustering mode which allows run multiple instances in a master-master mode.
This means that each instance is able to receive data which is in turn automatically being distributed to other instances.</p>
</div>
<div class="paragraph">
<p>Clustering is also a way to increase redundancy and fault tolerance since each instance can still run independently in case of a network failure or hardware fault of other instances.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>cluster.enabled</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This setting is optional and can be used to configure the network which the cluster daemons bind to.
Gentics Mesh will try to determine the network automatically if no setting has been provided.
The value of this setting will currently also be used to connect other instances to the configured instance.
So make sure that the IP/Host can be reached from other potential instances in your network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>cluster.networkHost</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host which will be used to bind clustering related ports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>cluster.clusterName</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the cluster which will be used to group multiple instances together.
The setting is required when clustering is enabled.
It can also be used to form a new cluster next to an existing cluster.
Only instances with the same clusterName will be able to find eachother.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>cluster.vertxPort</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 (random)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The vertxPort setting is used by the Vert.x eventbus message service.
By default vert.x will choose any free port and utilize it for the service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>nodeName</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node name is used to identify the instance in the cluster.
The name must be unique to a single instance and should not be changed.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">mesh.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">nodeName: "nodeA"
cluster:
  networkHost: "192.168.10.20"
  clusterName: "mesh.testing"
  vertxPort: 0
  enabled: true</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_port_mapping">Port Mapping</h3>
<div class="paragraph">
<p>Clustering involves the following components: Vert.x, OrientDB, Hazelcast. Each component utilize different ports.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Table Port Mappings</caption>
<colgroup>
<col style="width: 5%;">
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Default Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Configuration file</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vert.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0  (random, eventbus server)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mesh.yml</code> - <code>cluster/vertxPort</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrientDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2424-2430 (binary), 2480-2490 (HTTP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>orientdb-server-config.xml</code> - <code>network/listeners/listener</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hazelcast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2434 (dynamic)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.xml</code> - <code>network/port</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup">Setup</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Initial setup</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have not yet run Gentics Mesh with clustering mode disabled you need to setup a database first. You can either start Gentics Mesh in single mode and stop it and start it again in clustering mode or start Gentics Mesh directly using the <code>-initCluster</code> command line argument.
Similar to the first time when you start Gentics Mesh in single mode a new data directory will be created for you. The only difference is that new instances will be able to connect to your instance right away.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding slaves</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have not yet setup a database and just start Gentics Mesh with clustering enabled not much will happen. It will wait for other instances in the cluster which can provide a database for it.</p>
</div>
<div class="paragraph">
<p>You can start up additional instances once your initial cluster instance is up and running.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable clustering on an non-clustered instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Just set the <code>cluster.enabled</code> flag and specify a <code>cluster.clusterName</code> within your <code>mesh.yml</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_node_discovery">Node discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default all nodes will be discovered using <a href="https://en.wikipedia.org/wiki/Multicast_Source_Discovery_Protocol">multicast discovery</a>.
In that configuration all instances must share the same network and be able to receive multicast broadcast messages.</p>
</div>
<div class="paragraph">
<p>Alternatively it is also possible to hardcode the IP addresses of the cluster instances within the <code>hazelcast.xml</code> file. Just replace the existing join section with the following one:</p>
</div>
<div class="listingblock">
<div class="title">hazelcast.xml</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">...
  &lt;join&gt;
      &lt;multicast enabled="false"/&gt;
      &lt;tcp-ip enabled="true"&gt;
   	  &lt;member&gt;192.168.10.100&lt;/member&gt; &lt;!-- instance A --&gt;
   	  &lt;member&gt;192.168.10.101&lt;/member&gt; &lt;!-- instance B --&gt;
    &lt;/tcp-ip&gt;
  &lt;/join&gt;
...</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_kubernetes">Kubernetes</h3>
<div class="paragraph">
<p>The <a href="https://github.com/hazelcast/hazelcast-kubernetes">hazelcast-kubernetes</a> plugin can be used to enable autodiscovery of nodes in a kubernetes environment. The plugin itself is already part of Gentics Mesh and just needs to be configured in the <code>hazelcast.xml</code> file.</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="title">hazelcast.xml</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">...
&lt;network&gt;
        &lt;port auto-increment="true"&gt;5701&lt;/port&gt;
        &lt;join&gt;
            &lt;!-- deactivate normal discovery --&gt;
            &lt;multicast enabled="false"/&gt;
            &lt;tcp-ip enabled="false" /&gt;

            &lt;!-- activate the Kubernetes plugin --&gt;
            &lt;discovery-strategies&gt;
                &lt;discovery-strategy enabled="true"
                        class="com.hazelcast.kubernetes.HazelcastKubernetesDiscoveryStrategy"&gt;
                    &lt;properties&gt;
                        &lt;property name="service-dns"&gt;MY-SERVICE-DNS-NAME&lt;/property&gt;
                        &lt;property name="service-dns-timeout"&gt;10&lt;/property&gt;
                    &lt;/properties&gt;
                &lt;/discovery-strategy&gt;
            &lt;/discovery-strategies&gt;
        &lt;/join&gt;
  &lt;/network&gt;
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details on the setup of the plugin please take a look at the <a href="https://github.com/hazelcast/hazelcast-kubernetes">documentation</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_distribution">Session distribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Gentics Mesh is not using sessions it is not needed to distribute sessions across the cluster. A <a href="https://jwt.io/introduction/">JWT</a> will be used to authenticate the user.
Each instance of Gentics Mesh is able to validate the JWT by using the crypographic key which has been stored in the <code>config/keystore.jceks</code> file. This means the same <code>keystore.jceks</code> must be available on each instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_elasticsearch">Elasticsearch</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note that the Elasticsearch needs to be clustered dedicatedly. This can be achieved by running a configured dedicated instance or by configuring the instance that is started by Gentics Mesh.
Please refer to the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/discovery-settings.html">Elasticsearch documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_binary_data">Handling binary data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>File uploads are currently not automatically being distributed. This means that it is required to share the data of the upload directory manually.
One option would be to use a <a href="https://en.wikipedia.org/wiki/List_of_file_systems#Distributed_file_systems">distributed file system</a> like <a href="https://en.wikipedia.org/wiki/GlusterFS">GlusterFS</a>, <a href="https://en.wikipedia.org/wiki/Amazon_S3">S3</a> or <a href="https://en.wikipedia.org/wiki/Network_File_System">NFS</a>.
The only directory which needs to be shared across the cluster is the upload directory which can be configured in the <code>mesh.yml</code> file.</p>
</div>
<div class="listingblock">
<div class="title">mesh.yml</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">upload:
  directory: "data/binaryFiles"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cluster_coordination">Cluster Coordination</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A cluster request coordinator can be enabled to add a coordination layer in each Gentics Mesh instance.</p>
</div>
<div class="paragraph">
<p>This layer will automatically delegate requests to an elected master instance.</p>
</div>
<div class="paragraph">
<p>This process is useful when running a multi-master or master-replica setup.</p>
</div>
<div class="paragraph">
<p>In a multi-master setup the write requests on all instances will be directed to an elected master instance.
This is useful in order to reduce contention and to avoid synchronization issues.</p>
</div>
<div class="paragraph">
<p>In a master-replica setup this can be useful to delegate write requests on replica instances to the elected master instance.</p>
</div>
<div class="sect2">
<h3 id="_configuration_2">Configuration</h3>
<div class="paragraph">
<p>By default the coordination layer is disabled and first needs to be enabled in the cluster settings.</p>
</div>
<div class="sect3">
<h4 id="_modes">Modes</h4>
<div class="paragraph">
<p>The <code>cluster.coordinatorMode</code> setting or <code>MESH_CLUSTER_COORDINATOR_MODE</code> environment variable can control how the coordinator should behave.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DISABLED</code> - In this mode no coordination of requests will be done.</p>
</li>
<li>
<p><code>CUD</code> - In this mode only write requests (Create, Update, Delete) will be delegated to the elected master. All other requests will be directly processed by the instance.</p>
</li>
<li>
<p><code>ALL</code> - In this mode all requests (CRUD) will be delegated to the elected master.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_topology_management">Topology management</h4>
<div class="paragraph">
<p>The <code>cluster.coordinatorTopology</code> setting or <code>MESH_CLUSTER_COORDINATOR_TOPOLOGY</code> environment variable controls whether the coordinator will also manage the current cluster topology. By default no cluster topology management will be done.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>UNMANAGED</code> - Don&#8217;t manage cluster topology.</p>
</li>
<li>
<p><code>MASTER_REPLICA</code> - Use the elected master also as database master and make other nodes in the cluster replicas.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The topology can only be managed when the coordination mode is not disabled.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_master_election">Master Election</h3>
<div class="paragraph">
<p>The <code>cluster.coordinatorRegex</code> setting or <code>MESH_CLUSTER_COORDINATOR_REGEX</code> environment variable controls which nodes in the cluster can be elected as master instances.</p>
</div>
<div class="paragraph">
<p>Example: The regex <code>gentics-mesh-[0-9]</code> would only match nodes <code>gentics-mesh-0</code>, <code>gentics-mesh-1</code> but not <code>gentics-mesh-backup</code>.</p>
</div>
<div class="paragraph">
<p>A new master will automatically be elected whenever the master instance is no longer online.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only instances which provide a master database can be elected. Replica servers are not eligible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_headers">Headers</h3>
<div class="paragraph">
<p>Delegation can be disabled for individual requests when adding the <code>X-Mesh-Direct: true</code> header to the request.</p>
</div>
<div class="paragraph">
<p>If a request was delegated, the <code>X-Mesh-Forwarded-From</code> will be added to the response. The value of this header is the name of the node from which the request was forwarded from.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transaction_handling_change_propagation">Transaction handling / Change propagation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Transactions are directly being handled by <a href="https://orientdb.com/docs/3.0.x/internals/Transactions.html">OrientDB</a>.</p>
</div>
<div class="paragraph">
<p>The distribution of data (write) is executed synchronous and will be directly visible on other instances.
Operations which modify permissions are handled asynchronous and may take a few milliseconds to propagate throughout the cluster.
Operations which invoke node, micronode or branch migrations can only be executed separately throughout the cluster.
A running migration on one instance will cause the other instances of the cluster to reject any migration request as long as a migration is active.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrading_a_cluster">Upgrading a cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two types of upgrades. An upgrade can either be handled online of offline.</p>
</div>
<div class="sect2">
<h3 id="_online_upgrade">Online Upgrade</h3>
<div class="paragraph">
<p>Online upgrades can happen without any downtime. First you stop a single instance within your cluster. Next you start the instance up again using the new Gentics Mesh version.
The instance will directly join the cluster and receive the changes from other instances. This is possible since the newly started Gentics Mesh version uses the same
<a href="../../docs/administration-guide/#database-revisions">database revision</a> as the older version.</p>
</div>
<div class="paragraph">
<p><strong>Rollback</strong>:
You can rollback by stopping the Gentics Mesh version and starting the older version.</p>
</div>
</div>
<div class="sect2">
<h3 id="_offline_upgrade">Offline Upgrade</h3>
<div class="paragraph">
<p>Offline upgrades are required when database changes need to be applied. These changes could negatively impact other (older) instances in the cluster and thus an offline upgrade will
only occur locally and not directly propagate throughout the cluster. Gentics Mesh will not join the cluster in such situations.
The cluster will only form in-between versions which use the same database revision. You can check the list of <a href="../../docs/administration-guide/#database-revisions">Database revisions</a> in
order to determine whether an online or offline upgrade can be done.</p>
</div>
<div class="paragraph">
<p>Data which has been written to other instances in the cluster <em>can&#8217;t</em> be merged back to the now upgraded instance. Instead the upgraded instance will act as a new source of truth.
Other instances in the cluster need to be stopped one by one and restarted with the new version. The database from the initially migrated instance will be replicated to these instances and replace their older database.
The old database will be moved in a backup location and can later be deleted. You could alternatively also just start new instances which replicate the data and afterwards drop the now outdated cluster.</p>
</div>
<div class="paragraph">
<p><strong>Rollback</strong>:
You can rollback as long as you still have instances which have not yet been migrated by just starting older Gentics Mesh instances. These instances will automatically join the corresponding cluster with the same database revision.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aws_gce">AWS / GCE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is currently no built-in support for these platforms.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scaling">Scaling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When dynamic discovery via multicast is enabled it is possible to just start additional Gentics Mesh instances in order to scale horizontally.
The newly start instances must not have any data within the graph storage directory. The needed data will automatically be replicated when joining the cluster.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faq">FAQ</h2>
<div class="sectionbody">
<div class="qlist qanda">
<ol>
<li>
<p><em>What happens if my initial instances crashes?</em></p>
<p>The cluster automatically realigns itself and operation can continue normally.</p>
</li>
<li>
<p><em>Can I add new instances at any time?</em></p>
<p>Yes. New instances can be added at any time.</p>
</li>
<li>
<p><em>Are my changes directly visible on other instances?</em></p>
<p>The replication handles this as fast as the network allows but by default replication is happening synchronous to full fill the <code>writeQuorum</code> and asynchronous once the quorum has been satisfied.
which means that it could take a few moments until your changes are propagated throughout the cluster.
This behaviour is configurable via the OrientDB <code>writeQuorum</code> setting. Take a look at the <a href="https://orientdb.com/docs/3.0.x/distributed/Distributed-Configuration.html">OrientDB distributed configuration</a> if you want to know more.
Our tests currently only cover the <code>writeQuorum</code> and <code>readQuorum</code> of <strong>1</strong>.</p>
</li>
<li>
<p><em>What happens if the network between my instances fails?</em></p>
<p>The instances will continue to operate normally but will no longer be able to see each other&#8217;s changes.
Once the network issue is resolved the instances will update them self and resume normal operation.</p>
</li>
<li>
<p><em>I want to use a load balancer to distribute load across my instances. Do I need to handle sticky sessions?</em></p>
<p>Gentics Mesh does not use sessions. Instead a stateless JWT mechanism is used. This means you can direct your traffic to any of clustered instances. No need to setup something special.</p>
</li>
<li>
<p><em>Can I use sharding to split up my data across multiple data centers?</em></p>
<p>No. Sharding is not supported but you are still able to span a cluster across multiple datacenters.</p>
</li>
<li>
<p><em>Can I split a single cluster into one or more clusters?</em></p>
<p>Yes. This can be done by starting a new cluster using a different <code>cluster.clusterName</code> setting within the <code>mesh.yml</code> file.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring">Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>/api/v2/admin/cluster/status</code> endpoint can be used to retrieve information about the cluster topology and status of instances within the cluster.</p>
</div>
<div class="paragraph">
<p>Additionally it is possible to access the JMX beans of OrientDB.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_limitations">Limitations</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Binary data (uploads) are currently not automatically being distributed to other nodes.
You may use a clustering filesystem or NFS to share this data.</p>
</li>
<li>
<p>All cluster instances must use the same Gentics Mesh version.
Checks have been added to prevent instances from joining a cluster if the Gentics Mesh version does not match up.</p>
</li>
<li>
<p>It is currently not possible to configure network bind host and different network host announce host.
The node must currently bind to the same network which is also used to connect to the host.</p>
</li>
</ul>
</div>
</div>
</div>

        



        
      </div>
    </div>
  </div>


    <div class="footer">
    <a name="footer"></a>
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h2>Keep in touch</h2>
                <p>Find us on Twitter
                    <a href="https://twitter.com/genticsmesh" target="_blank" rel="noopener noreferrer">@genticsmesh</a>
                </p>
                <p>Get help on
                    <a href="https://stackoverflow.com/questions/tagged/gentics-mesh" target="_blank" rel="noopener noreferrer">stackoverflow</a>
                </p>
                <p>Ask us anything on
                    <a href="https://gitter.im/gentics/mesh" target="_blank" rel="noopener noreferrer">Gitter</a>
                </p>
                <p>Dive into the code at
                    <a href="https://github.com/gentics/mesh" target="_blank" rel="noopener noreferrer">GitHub</a>
                </p>
            </div>
            <div class="col-md-6">
                <h2>Legal</h2>
                <p>Licensed under
                    <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer">Apache License v2.0</a> |
                    <a href="../../imprint">Imprint</a>
                </p>
            </div>
        </div>
        <div class="row ending center">
            <p class="padding-top-25">Made in
                <a href="https://www.mercer.com/newsroom/2018-quality-of-living-survey.html" target="_blank" rel="noopener noreferrer">Vienna - the most livable city in the world</a> 
                <img src="../../assets/noun_Wine_1032235.svg" height="24">
            </p>
        </div>
    </div>

       

        <div class="apa-consent-reset apa-consent-wrapper">


            <div class="apa-consent-reset apa-consent-bgColor apa-consent-boxShadow apa-consent-banner testOFF">

                <ul class="apa-consent-reset apa-consent-bannerContent">
                    <li class="apa-consent-reset">
                        <div class="apa-consent-reset apa-consent-bannerText">
                        </div>
                    </li>
                    <li class="apa-consent-reset apa-consent-buttonWrapperDetails">
                        <button class="apa-consent-reset apa-consent-button">
                            cookie-preferences
                        </button>
                    </li>
                    <li class="apa-consent-reset apa-consent-buttonWrapperAccept">
                        <button id="apa-consent-button-accept" class="apa-consent-reset apa-consent-button">
                            accept
                        </button>
                    </li>
                </ul>

                <div class="apa-consent-reset apa-consent-bgColorWhite apa-consent-boxShadow apa-consent-bannerButtonOFF">
                    <div class="apa-consent-reset apa-consent-bannerButtonOFFicon1 apa-consent-bgColor"></div>
                    <div class="apa-consent-reset apa-consent-bannerButtonOFFicon2 apa-consent-bgColor"></div>
                </div>

            </div>

            <div class="apa-consent-reset apa-consent-dialogWrapper testOFF">
                <div class="apa-consent-reset apa-consent-bgColor apa-consent-boxShadow apa-consent-dialog">
                    <div class="apa-consent-reset apa-consent-mobileScroller">

                        <div class="apa-consent-reset apa-consent-mobileClose"></div>

                        <div class="apa-consent-reset apa-consent-dialogInnerWidth apa-consent-dialogHeader">
                            <h3 class="apa-consent-reset apa-consent-H3">
                                Cookie Preferences
                            </h3>
                            <p class="apa-consent-reset apa-consent-P">
                                Choose if this website is only allowed to use functional cookies and/or marketing cookies.
                            </p>
                        </div>
                        <div class="apa-consent-reset apa-consent-dialogBodyWrapper">
                            <div class="apa-consent-reset apa-consent-dialogInnerWidth apa-consent-dialogBody">
                                <ul class="apa-consent-reset apa-consent-items">

                                </ul>
                            </div>
                        </div>
                        <div class="apa-consent-reset apa-consent-dialogInnerWidth apa-consent-dialogSubmit">
                            <button id="apa-constent-button-save-settings" class="apa-consent-reset apa-consent-button apa-consent-boxShadow">
                                save & close
                            </button>
                        </div>

                        <div class="apa-consent-reset apa-consent-bgColorWhite apa-consent-boxShadow apa-consent-dialogButtonOFF">
                            <div class="apa-consent-reset apa-consent-dialogButtonOFFicon1"></div>
                            <div class="apa-consent-reset apa-consent-dialogButtonOFFicon2 apa-consent-bgColor"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>


   <div  id="bannerButtonOpen" class="apa-consent-reset apa-consent-bgColor apa-consent-boxShadow apa-consent-bannerButtonON">
            <div class="apa-consent-reset apa-consent-bannerButtonONicon1 apa-consent-bgColorWhite"></div>
            <div class="apa-consent-reset apa-consent-bannerButtonONicon2 apa-consent-bgColorWhite"></div>
        </div>

        <div class="apa-consent-reset apa-consent-bgColor apa-consent-boxShadow apa-consent-dialogButtonON testOFF">
            <div class="apa-consent-reset apa-consent-dialogButtonONicon1 apa-consent-bgColorWhite"></div>
            <div class="apa-consent-reset apa-consent-dialogButtonONicon2 apa-consent-bgColorWhite"></div>
        </div>


     

        

            

    <ul style="display:none">
        <li id="prototypeAppEntry" class="apa-consent-reset apa-consent-item">
            <div class="apa-consent-reset apa-consent-itemSwitch">
                <span class="apa-consent-reset apa-consent-boxShadow"></span>
            </div>
            <div class="apa-consent-reset apa-consent-itemTitle">

            </div>
            <div class="apa-consent-reset apa-consent-itemText">

            </div>
            <div class="apa-consent-reset apa-consent-itemSubItems">
                <ul class="apa-consent-reset apa-consent-cookie-items">
                    <li id="prototypeAppEntryCookieItem" style="display:none" class="apa-consent-reset apa-consent-itemSubItem">
                        <div class="apa-consent-reset apa-consent-subItemTitle">
                            <div class="apa-consent-reset apa-consent-subItemSwitch"></div>
                            <span></span>
                        </div>
                        <div class="apa-consent-reset apa-consent-subItemText">
                            <p class="apa-consent-reset apa-consent-P"></p>
                        </div>
                    </li>
                </ul>
            </div>
        </li>

        <li id="prototypeAppEntryProtected" class="apa-consent-reset apa-consent-item">
            <div class="apa-consent-reset apa-consent-itemSwitch">
                <span class=" apa-consent-reset apa-consent-boxShadow"></span>
            </div>
            <div class="apa-consent-reset apa-consent-itemTitle apa-consent-itemTitleSwitch">
            </div>
            <div class="apa-consent-reset apa-consent-itemText">

            </div>
            <div class="apa-consent-reset apa-consent-itemSubItems">
                <ul class="apa-consent-reset apa-consent-cookie-items">

                    <li id="prototypeAppEntryProtectedCookieItem" style="display: none;" class="apa-consent-reset apa-consent-itemSubItem">
                        <div class="apa-consent-reset apa-consent-subItemTitle">
                            <div class="apa-consent-reset apa-consent-subItemSwitch"></div>
                            <span></span>
                        </div>
                        <div class="apa-consent-reset apa-consent-subItemText">
                            <p class="apa-consent-reset apa-consent-P"></p>
                        </div>
                    </li>
                </ul>
            </div>
        </li>

    </ul>


</div>

    
    <script
  src="https://code.jquery.com/jquery-1.12.4.min.js"
  integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
  crossorigin="anonymous"></script>

<script src="../../js/bootstrap.min.js"></script>

<script
  src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"
  crossorigin="anonymous"></script>

<script src="../../js/site.js"></script>

<script 
  src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/highlight.min.js"
  integrity="sha256-sHRX2PXOLRG+LQtTpvREFsWhMVu2AJnmzxpmogmddtM="
  crossorigin="anonymous"></script>

<script>hljs.initHighlightingOnLoad();</script>

<script src="../../js/docs.js"></script>
<script src="../../js/sidebar.js"></script>
<script src="../../js/GCM-banner.js"></script>
<script>
  var hasExample = jQuery(".graphql-example").length > 0;
  hasExample && document.write('<link rel="stylesheet" href="../../graphiql/graphiql.css" /><script src="../../graphiql/vendor/fetch.min.js">\x3C/script><script src="../../graphiql/vendor/react-16.8.6.min.js">\x3C/script><script src="../../graphiql/vendor/react-dom-16.8.6.min.js">\x3C/script><script src="../../graphiql/graphiql.js">\x3C/script><script src="../../graphiql/embedded.js">\x3C/script>');
</script>


       

        <div class="apa-consent-reset apa-consent-wrapper">


            <div class="apa-consent-reset apa-consent-bgColor apa-consent-boxShadow apa-consent-banner testOFF">

                <ul class="apa-consent-reset apa-consent-bannerContent">
                    <li class="apa-consent-reset">
                        <div class="apa-consent-reset apa-consent-bannerText">
                        </div>
                    </li>
                    <li class="apa-consent-reset apa-consent-buttonWrapperDetails">
                        <button class="apa-consent-reset apa-consent-button">
                            cookie-preferences
                        </button>
                    </li>
                    <li class="apa-consent-reset apa-consent-buttonWrapperAccept">
                        <button id="apa-consent-button-accept" class="apa-consent-reset apa-consent-button">
                            accept
                        </button>
                    </li>
                </ul>

                <div class="apa-consent-reset apa-consent-bgColorWhite apa-consent-boxShadow apa-consent-bannerButtonOFF">
                    <div class="apa-consent-reset apa-consent-bannerButtonOFFicon1 apa-consent-bgColor"></div>
                    <div class="apa-consent-reset apa-consent-bannerButtonOFFicon2 apa-consent-bgColor"></div>
                </div>

            </div>

            <div class="apa-consent-reset apa-consent-dialogWrapper testOFF">
                <div class="apa-consent-reset apa-consent-bgColor apa-consent-boxShadow apa-consent-dialog">
                    <div class="apa-consent-reset apa-consent-mobileScroller">

                        <div class="apa-consent-reset apa-consent-mobileClose"></div>

                        <div class="apa-consent-reset apa-consent-dialogInnerWidth apa-consent-dialogHeader">
                            <h3 class="apa-consent-reset apa-consent-H3">
                                Cookie Preferences
                            </h3>
                            <p class="apa-consent-reset apa-consent-P">
                                Choose if this website is only allowed to use functional cookies and/or marketing cookies.
                            </p>
                        </div>
                        <div class="apa-consent-reset apa-consent-dialogBodyWrapper">
                            <div class="apa-consent-reset apa-consent-dialogInnerWidth apa-consent-dialogBody">
                                <ul class="apa-consent-reset apa-consent-items">

                                </ul>
                            </div>
                        </div>
                        <div class="apa-consent-reset apa-consent-dialogInnerWidth apa-consent-dialogSubmit">
                            <button id="apa-constent-button-save-settings" class="apa-consent-reset apa-consent-button apa-consent-boxShadow">
                                save & close
                            </button>
                        </div>

                        <div class="apa-consent-reset apa-consent-bgColorWhite apa-consent-boxShadow apa-consent-dialogButtonOFF">
                            <div class="apa-consent-reset apa-consent-dialogButtonOFFicon1"></div>
                            <div class="apa-consent-reset apa-consent-dialogButtonOFFicon2 apa-consent-bgColor"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>


   <div  id="bannerButtonOpen" class="apa-consent-reset apa-consent-bgColor apa-consent-boxShadow apa-consent-bannerButtonON">
            <div class="apa-consent-reset apa-consent-bannerButtonONicon1 apa-consent-bgColorWhite"></div>
            <div class="apa-consent-reset apa-consent-bannerButtonONicon2 apa-consent-bgColorWhite"></div>
        </div>

        <div class="apa-consent-reset apa-consent-bgColor apa-consent-boxShadow apa-consent-dialogButtonON testOFF">
            <div class="apa-consent-reset apa-consent-dialogButtonONicon1 apa-consent-bgColorWhite"></div>
            <div class="apa-consent-reset apa-consent-dialogButtonONicon2 apa-consent-bgColorWhite"></div>
        </div>


     

        

            

    <ul style="display:none">
        <li id="prototypeAppEntry" class="apa-consent-reset apa-consent-item">
            <div class="apa-consent-reset apa-consent-itemSwitch">
                <span class="apa-consent-reset apa-consent-boxShadow"></span>
            </div>
            <div class="apa-consent-reset apa-consent-itemTitle">

            </div>
            <div class="apa-consent-reset apa-consent-itemText">

            </div>
            <div class="apa-consent-reset apa-consent-itemSubItems">
                <ul class="apa-consent-reset apa-consent-cookie-items">
                    <li id="prototypeAppEntryCookieItem" style="display:none" class="apa-consent-reset apa-consent-itemSubItem">
                        <div class="apa-consent-reset apa-consent-subItemTitle">
                            <div class="apa-consent-reset apa-consent-subItemSwitch"></div>
                            <span></span>
                        </div>
                        <div class="apa-consent-reset apa-consent-subItemText">
                            <p class="apa-consent-reset apa-consent-P"></p>
                        </div>
                    </li>
                </ul>
            </div>
        </li>

        <li id="prototypeAppEntryProtected" class="apa-consent-reset apa-consent-item">
            <div class="apa-consent-reset apa-consent-itemSwitch">
                <span class=" apa-consent-reset apa-consent-boxShadow"></span>
            </div>
            <div class="apa-consent-reset apa-consent-itemTitle apa-consent-itemTitleSwitch">
            </div>
            <div class="apa-consent-reset apa-consent-itemText">

            </div>
            <div class="apa-consent-reset apa-consent-itemSubItems">
                <ul class="apa-consent-reset apa-consent-cookie-items">

                    <li id="prototypeAppEntryProtectedCookieItem" style="display: none;" class="apa-consent-reset apa-consent-itemSubItem">
                        <div class="apa-consent-reset apa-consent-subItemTitle">
                            <div class="apa-consent-reset apa-consent-subItemSwitch"></div>
                            <span></span>
                        </div>
                        <div class="apa-consent-reset apa-consent-subItemText">
                            <p class="apa-consent-reset apa-consent-P"></p>
                        </div>
                    </li>
                </ul>
            </div>
        </li>

    </ul>



    <script>
    window.GCM.apps.whenAllowed('google', function () {
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-69994739-1', 'auto');
        ga('send', 'pageview');
    });
</script>
    
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "Gentics Mesh",
        "url": "https://getmesh.io",
        "logo": "https://getmesh.io/assets/gentics-mesh-logo.png",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "Laimgrubengasse 10",
            "addressRegion": "Vienna",
            "postalCode": "1060",
            "addressCountry": "Austria"
        },
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer support",
            "telephone": "+43-1-7109904-300",
            "email": "support@gentics.com"
        },
        "sameAs": [
            "https://twitter.com/genticsmesh",
            "https://github.com/gentics/mesh",
            "https://stackoverflow.com/questions/tagged/genticsmesh"
        ]
    }
</script>
</body>

</html>
